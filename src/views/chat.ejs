<!--/views/chat.ejs-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width , initial-scale=1.0">
    <title>Chat</title>
    <script src="/socket.io/socket.io.js"></script> <!-- Socket.IO -->
    
    <script>
        const socket = io({ query: { chat_id: "<%= chat_id %>" } }); // Pasar chat_id desde Express

        // Cargar el historial de mensajes
        socket.on("chat history", (messages) => {
            const chatBox = document.getElementById("chat-box");
            chatBox.innerHTML = "";
            messages.forEach((message) => {
                addMessageToChatBox(message.username, message.content);
            });
        });

        // Enviar un nuevo mensaje
        const sendMessage = () => {
            const messageInput = document.getElementById("message-input");
            const message = messageInput.value;
            if (message.trim()) {
                socket.emit("new message", { chat_id: <%= chat_id %> , user_id: <%= user_id %>, content: message });
                messageInput.value = "";
            }
        };

        // Recibir mensajes nuevos
        socket.on("new message", (message) => {
            addMessageToChatBox(message.username, message.content);
            // Feedback visual (opcional)
            const sendButton = document.getElementById("send-button");
            sendButton.disabled = false; // Reactivar bot√≥n
        });

        function addMessageToChatBox(username, content) {
            const chatBox = document.getElementById("chat-box");
            const messageElement = document.createElement("div");
            messageElement.className = "message";
            messageElement.innerHTML = `<strong>${username}:</strong> ${content}`;
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</head>

<body>
    <div id="chat-box"></div>
    <input type="text" id="message-input" placeholder="Escribe un mensaje">
    <button id="send-button" onclick="sendMessage()">Enviar</button>
</body>

</html>